syntax = "proto3";

package job.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/wolfeidau/airunner/gen/job/v1;jobv1";

// PrincipalService manages principals and certificates
service PrincipalService {
    // Principal management (admin only)
    rpc CreatePrincipal(CreatePrincipalRequest) returns (CreatePrincipalResponse) {
        option idempotency_level = IDEMPOTENT;
    }
    rpc GetPrincipal(GetPrincipalRequest) returns (GetPrincipalResponse) {
        option idempotency_level = NO_SIDE_EFFECTS;
    }
    rpc ListPrincipals(ListPrincipalsRequest) returns (ListPrincipalsResponse) {
        option idempotency_level = NO_SIDE_EFFECTS;
    }
    rpc SuspendPrincipal(SuspendPrincipalRequest) returns (SuspendPrincipalResponse) {
        option idempotency_level = IDEMPOTENT;
    }
    rpc ActivatePrincipal(ActivatePrincipalRequest) returns (ActivatePrincipalResponse) {
        option idempotency_level = IDEMPOTENT;
    }

    // Certificate management (admin only)
    rpc RegisterCertificate(RegisterCertificateRequest) returns (RegisterCertificateResponse) {
        option idempotency_level = IDEMPOTENT;
    }
    rpc RevokeCertificate(RevokeCertificateRequest) returns (RevokeCertificateResponse) {
        option idempotency_level = IDEMPOTENT;
    }
    rpc ListCertificates(ListCertificatesRequest) returns (ListCertificatesResponse) {
        option idempotency_level = NO_SIDE_EFFECTS;
    }
}

// Principal types
enum PrincipalType {
    PRINCIPAL_TYPE_UNSPECIFIED = 0;
    PRINCIPAL_TYPE_ADMIN = 1;
    PRINCIPAL_TYPE_WORKER = 2;
    PRINCIPAL_TYPE_USER = 3;
    PRINCIPAL_TYPE_SERVICE = 4;
}

// Principal status
enum PrincipalStatus {
    PRINCIPAL_STATUS_UNSPECIFIED = 0;
    PRINCIPAL_STATUS_ACTIVE = 1;
    PRINCIPAL_STATUS_SUSPENDED = 2;
    PRINCIPAL_STATUS_DELETED = 3;
}

// Principal messages
message Principal {
    string principal_id = 1;
    PrincipalType type = 2;
    PrincipalStatus status = 3;
    google.protobuf.Timestamp created_at = 4;
    string created_by = 5;
    string email = 6;
    string description = 7;
    int32 max_certificates = 8;
    google.protobuf.Timestamp suspended_at = 9;
    string suspended_reason = 10;
}

message CreatePrincipalRequest {
    string principal_id = 1;
    PrincipalType type = 2;
    string email = 3;
    string description = 4;
}

message CreatePrincipalResponse {
    google.protobuf.Timestamp created_at = 1;
}

message GetPrincipalRequest {
    string principal_id = 1;
}

message GetPrincipalResponse {
    Principal principal = 1;
}

message ListPrincipalsRequest {
    PrincipalType type = 1;
    PrincipalStatus status = 2;
}

message ListPrincipalsResponse {
    repeated Principal principals = 1;
}

message SuspendPrincipalRequest {
    string principal_id = 1;
    string reason = 2;
}

message SuspendPrincipalResponse {
    google.protobuf.Timestamp suspended_at = 1;
}

message ActivatePrincipalRequest {
    string principal_id = 1;
}

message ActivatePrincipalResponse {
    google.protobuf.Timestamp activated_at = 1;
}

// Certificate messages
message Certificate {
    string serial_number = 1;
    string principal_id = 2;
    string principal_type = 3;
    string fingerprint = 4;
    string subject_dn = 5;
    google.protobuf.Timestamp issued_at = 6;
    google.protobuf.Timestamp expires_at = 7;
    bool revoked = 8;
    google.protobuf.Timestamp revoked_at = 9;
    string revocation_reason = 10;
    string description = 11;
}

message RegisterCertificateRequest {
    string serial_number = 1;
    string principal_id = 2;
    string principal_type = 3;
    string fingerprint = 4;
    string subject_dn = 5;
    google.protobuf.Timestamp issued_at = 6;
    google.protobuf.Timestamp expires_at = 7;
    string description = 8;
}

message RegisterCertificateResponse {
    google.protobuf.Timestamp registered_at = 1;
}

message RevokeCertificateRequest {
    string serial_number = 1;
    string reason = 2;
}

message RevokeCertificateResponse {
    google.protobuf.Timestamp revoked_at = 1;
}

message ListCertificatesRequest {
    string principal_id = 1;
    bool include_revoked = 2;
}

message ListCertificatesResponse {
    repeated Certificate certificates = 1;
}
